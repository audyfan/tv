<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动态直播源播放器（12小时有效）</title>
</head>
<body>
    <h1>动态直播源播放器（12小时有效）</h1>
    <video id="videoPlayer" width="640" height="360" controls>
        <p>你的浏览器不支持 HTML5 视频播放。</p>
    </video>
    <p id="status">正在加载直播源...</p>

    <script>
        // 你的动态源接口地址（已替换为实际链接）
        const BASE_SOURCE_URL = "https://mirror.ghproxy.com/https://raw.githubusercontent.com/qingtingjjjjjjj/zhixueyiyi-tv/refs/heads/main/merged_output.txt";

        // 获取 HTML 元素
        const videoPlayer = document.getElementById("videoPlayer");
        const status = document.getElementById("status");

        // 生成带时间戳的动态 URL
        function generateDynamicUrl(baseUrl) {
            const timestamp = Math.floor(Date.now() / 1000); // 当前时间戳（秒）
            const validUntil = timestamp + 12 * 60 * 60; // 12小时后失效
            return `${baseUrl}?t=${validUntil}`;
        }

        // 获取直播源列表
        async function fetchStreams() {
            try {
                const dynamicUrl = generateDynamicUrl(BASE_SOURCE_URL); // 动态生成接口地址
                const response = await fetch(dynamicUrl, { cache: "no-cache" });
                if (!response.ok) throw new Error(`网络错误：${response.status}`);
                
                // 按行解析文本内容
                const text = await response.text();
                return text.trim().split("\n").filter(url => url.length > 0);
            } catch (error) {
                console.error("加载直播源失败：", error);
                status.textContent = "加载直播源失败，请稍后再试。";
                return [];
            }
        }

        // 加载并播放直播源
        async function loadAndPlay() {
            const streams = await fetchStreams();
            if (streams.length === 0) {
                status.textContent = "没有可用的直播源。";
                return;
            }

            // 尝试播放第一个直播源
            try {
                const firstStream = streams[0];
                videoPlayer.src = firstStream;
                await videoPlayer.play();
                status.textContent = `正在播放：${firstStream}`;
                console.log(`正在播放：${firstStream}`);
            } catch (error) {
                console.error("播放失败：", error);
                status.textContent = "无法播放直播源，请检查 URL 或网络。";
            }
        }

        // 自动刷新（12小时后自动重新加载）
        function scheduleRefresh() {
            const twelveHours = 12 * 60 * 60 * 1000; // 12小时（毫秒）
            setTimeout(() => {
                console.log("12小时已到，重新加载直播源...");
                loadAndPlay();
            }, twelveHours);
        }

        // 页面加载时启动
        loadAndPlay();
        scheduleRefresh();
    </script>
</body>
</html>